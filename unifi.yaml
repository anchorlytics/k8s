---
apiVersion: v1
kind: Namespace
metadata:
  name: unifi

---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: unifi
  namespace: kube-system
spec:
  repo: "https://k8s-at-home.com/charts"
  chart: unifi
  version: 1.3.1
  targetNamespace: unifi
  valuesContent: |-
    image:
      tag: 5.6
    timezone: America/Vancouver
    ingress:
      enabled: true
      hosts:
      - unifi.home.seanho.com
      tls:
      - hosts:
        - unifi.home.seanho.com
        secretName: unifi-tls
    controllerService:
      type: LoadBalancer
      loadBalancerIP: 10.90.3.97
      annotations:
        metallb.universe.tf/allow-shared-ip: unifi
    stunService:
      type: LoadBalancer
      loadBalancerIP: 10.90.3.97
      annotations:
        metallb.universe.tf/allow-shared-ip: unifi
    discoveryService:
      type: LoadBalancer
      loadBalancerIP: 10.90.3.97
      annotations:
        metallb.universe.tf/allow-shared-ip: unifi

---
# replicated from chart, to use proper apiVersion
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: unifi
  namespace: unifi
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
spec:
  rules:
  - host: unifi.home.seanho.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: unifi-gui
            port:
              name: https-gui
  tls:
  - hosts:
    - unifi.home.seanho.com
    secretName: unifi-tls

